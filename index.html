<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sacred Portrait - Debug Mode</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; color: white; font-family: sans-serif; }
        canvas { display: block; }
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; width: 80%; line-height: 1.5;
            background: rgba(0,0,0,0.8); padding: 20px; border: 1px solid #555; z-index: 1000;
        }
        #error-log { color: #ff5555; margin-top: 10px; font-size: 14px; word-break: break-all; }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
</head>
<body>
    <div id="loading">
        Status: Initializing...<br>
        <div id="error-log"></div>
    </div>

    <script type="module">
        import * as THREE from 'three';

        const logBox = document.getElementById('loading');
        const errBox = document.getElementById('error-log');

        // エラーを画面に出す関数
        function showError(msg) {
            errBox.innerHTML += `ERROR: ${msg}<br>`;
            logBox.style.borderColor = 'red';
        }

        // グローバルエラー監視
        window.onerror = function(message, source, lineno, colno, error) {
            showError(`${message} (Line: ${lineno})`);
        };

        try {
            logBox.innerHTML = "Status: Three.js Loaded. Starting Scene...<br><div id='error-log'></div>";
            
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x1a1a1a, 0.03);
            
            const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 0, 10);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // ライト
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffaa55, 2);
            dirLight.position.set(5, 10, 10);
            scene.add(dirLight);

            // 画像読み込み
            logBox.innerHTML += "Status: Loading image.png...<br>";
            
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load(
                'image.png', // 読み込むファイル
                (texture) => {
                    // 成功時
                    logBox.style.display = 'none'; // ローディング消去
                    
                    const aspect = texture.image.width / texture.image.height;
                    const geometry = new THREE.PlaneGeometry(5 * aspect, 5);
                    const material = new THREE.MeshStandardMaterial({ map: texture });
                    const mesh = new THREE.Mesh(geometry, material);
                    scene.add(mesh);

                    // アニメーション
                    function animate() {
                        requestAnimationFrame(animate);
                        mesh.rotation.y += 0.005;
                        renderer.render(scene, camera);
                    }
                    animate();
                },
                undefined, // 進捗 (無視)
                (err) => {
                    // 画像読み込み失敗時
                    console.error(err);
                    showError("FAILED to load image.png.<br>Check file name or format.");
                }
            );

        } catch (e) {
            showError("Script Crash: " + e.message);
        }
    </script>
</body>
</html>
